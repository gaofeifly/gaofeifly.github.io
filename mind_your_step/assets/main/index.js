System.register("chunks:///main.js",["cc"],(function(){"use strict";var t,e,i,n,r,o,a,u,l,s,c,p,h,d,f,m,_;return{setters:[function(y){t=y.cclegacy,e=y._decorator,i=y.Component,n=y.AudioSource,r=y.AudioClip,o=y.director,a=y.Director,u=y.Canvas,l=y.Camera,s=y.game,c=y.Node,p=y.SkeletalAnimation,h=y.Vec3,d=y.Label,f=y.Prefab,m=y.CCInteger,_=y.instantiate}],execute:function(){function y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function b(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,v(t,e)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function S(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function C(t,e,i,n,r){var o={};return Object.keys(n).forEach((function(t){o[t]=n[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce((function(i,n){return n(t,e,i)||i}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}var T;t._RF.push({},"28bd63vuN5NYKF2hAjWK9Mi","NewComponent",void 0);var N,P,w,I,M,E,R,G=e.ccclass;e.property,G("NewComponent")(T=function(t){function e(){return t.apply(this,arguments)||this}return b(e,t),e.prototype.start=function(){},e}(i));t._RF.pop(),t._RF.push({},"49479d/7wBLz69V7WU6q2pf","AudioController",void 0);var A=e.ccclass,z=e.property,L=(N=A("AudioController"),P=z(n),w=z(r),N((E=C((M=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return S(e=t.call.apply(t,[this].concat(n))||this,"audio",E,g(e)),S(e,"sound",R,g(e)),e}b(e,t);var i=e.prototype;return i.play=function(){this.audio.play()},i.pause=function(){this.audio.pause()},i.playOneShot=function(){this.audio.playOneShot(this.sound,1)},e}(i)).prototype,"audio",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=C(M.prototype,"sound",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=M))||I);t._RF.pop(),t._RF.push({},"55d527cfupI+5Iw1qenROtL","migrate-canvas",void 0);var O=1048575;function B(t,e){for(var i=0,n=t.children.length;i<n;i++)t.children[i].layer=e,B(t.children[i],e)}o.on(a.EVENT_AFTER_SCENE_LAUNCH,(function(){var t,e,i,n=null===(t=o.getScene())||void 0===t?void 0:t.children,r=null===(e=o.getScene())||void 0===e?void 0:e.getComponentsInChildren(u);if(!(r.length<=1)){r=r.filter((function(t){return!!t.cameraComponent}));var a=null===(i=o.getScene())||void 0===i?void 0:i.getComponentsInChildren(l),c=0;a.forEach((function(t){return c|=t.visibility&O}));for(var p=[],h=0,d=n.length;h<d;h++){var f=n[h];if(s.isPersistRootNode(f)){var m=f.getComponentsInChildren(u);0!==m.length&&p.push.apply(p,m.filter((function(t){return!!t.cameraComponent})))}}p.forEach((function(t){if(r.find((function(e){return e!==t&&e.cameraComponent.visibility&t.cameraComponent.visibility&O}))){var e=~c,i=e&~(e-1);t.cameraComponent.visibility=i|4293918720&t.cameraComponent.visibility,B(t.node,i),c|=e}}))}}));var J,x,j,D,k,F,Y,H=c.prototype.setParent;function K(t){var e=0,i=t.getComponent(u);return i&&i.cameraComponent?e=i.cameraComponent.visibility&i.node.layer?i.node.layer:i.cameraComponent.visibility&~(i.cameraComponent.visibility-1):(t.parent&&(e=K(t.parent)),e)}c.prototype.setParent=function(t,e){if(H.call(this,t,e),t){var i=K(this);i&&(this.layer=i,B(this,i))}},t._RF.pop(),t._RF.push({},"a9447Do3TpKt6QJ4iMnyzXg","PlayerController",void 0);var V,q,U,W,Z,Q,X,$,tt,et,it,nt,rt,ot,at,ut,lt,st,ct,pt,ht,dt,ft,mt,_t,yt=e.ccclass,bt=e.property,vt=(J=yt("PlayerController"),x=bt({type:p}),j=bt({type:c}),J((F=C((k=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return S(e=t.call.apply(t,[this].concat(n))||this,"CocosAnim",F,g(e)),S(e,"Handle",Y,g(e)),e._startJump=!1,e._jumpStep=0,e._curJumpTime=0,e._jumpTime=.5,e._curJumpSpeed=0,e._curPos=new h,e._deltaPos=new h(0,0,0),e._targetPos=new h,e.curMoveIndex=0,e}b(e,t);var i=e.prototype;return i.start=function(){},i.setInputActive=function(t){this.Handle&&(this.Handle.active=t)},i.onOneStepClick=function(){this.jumpByStep(1)},i.onTwoStepClick=function(){this.jumpByStep(2)},i.jumpByStep=function(t){this._startJump||(this._startJump=!0,this.node.emit("JumpStart"),this._jumpStep=t,this._curJumpTime=0,this._curJumpSpeed=this._jumpStep/this._jumpTime,this.node.getPosition(this._curPos),h.add(this._targetPos,this._curPos,new h(this._jumpStep,0,0)),this.curMoveIndex+=t,this.CocosAnim&&(this.CocosAnim.getState("cocos_anim_jump").speed=1.5,this.CocosAnim.play("cocos_anim_jump")))},i.reset=function(){this.curMoveIndex=0},i.onOnceJumpEnd=function(){this.CocosAnim&&this.CocosAnim.play("cocos_anim_idle"),this.node.emit("JumpEnd",this.curMoveIndex)},i.update=function(t){this._startJump&&(this._curJumpTime+=t,this._curJumpTime>this._jumpTime?(this.node.setPosition(this._targetPos),this._startJump=!1,this.onOnceJumpEnd()):(this.node.getPosition(this._curPos),this._deltaPos.x=this._curJumpSpeed*t,h.add(this._curPos,this._curPos,this._deltaPos),this.node.setPosition(this._curPos)))},e}(i)).prototype,"CocosAnim",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=C(k.prototype,"Handle",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=k))||D);t._RF.pop(),t._RF.push({},"dd75fGZMRBD6YPFBbdorldb","GameManager",void 0);var gt,St,Ct=e.ccclass,Tt=e.property;!function(t){t[t.BT_NONE=0]="BT_NONE",t[t.BT_STONE=1]="BT_STONE"}(gt||(gt={})),function(t){t[t.GS_INIT=0]="GS_INIT",t[t.GS_PLAYING=1]="GS_PLAYING",t[t.GS_END=2]="GS_END"}(St||(St={}));V=Ct("GameManager"),q=Tt({type:d}),U=Tt({type:f}),W=Tt({type:vt}),Z=Tt({type:c}),Q=Tt({type:c}),X=Tt({type:d}),$=Tt({type:d}),tt=Tt({type:d}),et=Tt({type:m}),it=Tt({type:L}),V((ot=C((rt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return S(e=t.call.apply(t,[this].concat(n))||this,"stepsLabel",ot,g(e)),S(e,"cubePrfb",at,g(e)),S(e,"initRoadLength",ut,g(e)),S(e,"roadMaxLength",lt,g(e)),e._road=[],S(e,"playerCtrl",st,g(e)),S(e,"startMenu",ct,g(e)),S(e,"endMenu",pt,g(e)),S(e,"endTitle",ht,g(e)),S(e,"endScore",dt,g(e)),S(e,"endTime",ft,g(e)),S(e,"_maxStayDuration",mt,g(e)),e._curStayDuration=0,e._curState=St.GS_INIT,e._refreshStep=10,e._canGenRoad=!0,e._refreshNum=0,e._startStamp=0,S(e,"audioController",_t,g(e)),e}b(e,t);var i,n,r,o=e.prototype;return o.start=function(){var t,e;this.curState=St.GS_INIT,null===(t=this.playerCtrl)||void 0===t||t.node.on("JumpEnd",this.onPlayerJumpEnd,this),null===(e=this.playerCtrl)||void 0===e||e.node.on("JumpStart",this.onPlayerJumpStart,this)},o.onPlayerJumpStart=function(){var t;this._curStayDuration=0,this._canGenRoad=!0,null===(t=this.audioController)||void 0===t||t.playOneShot()},o.onPlayerJumpEnd=function(){if(this.stepsLabel){var t,e=(null===(t=this.playerCtrl)||void 0===t?void 0:t.curMoveIndex)||0;this.stepsLabel.string=""+(e>=this.roadMaxLength?this.roadMaxLength:e)}this.checkResult()},o.backStartMenu=function(){this.curState=St.GS_INIT},o.init=function(){this._curStayDuration=0,this._refreshNum=0,this.startMenu&&(this.startMenu.active=!0),this.endMenu.active=!1,this.initRoad(),this.playerCtrl&&(this.playerCtrl.setInputActive(!1),this.playerCtrl.node.setPosition(h.ZERO),this.playerCtrl.reset())},o.checkResult=function(){var t,e=(null===(t=this.playerCtrl)||void 0===t?void 0:t.curMoveIndex)||0;e<this.roadMaxLength?this._road[e]==gt.BT_NONE&&(this.curState=St.GS_END):this.curState=St.GS_END},o.generateBlocks=function(t,e){for(var i=t;i<e;i++)0===i||this._road[i-1]===gt.BT_NONE?this._road.push(gt.BT_STONE):this._road.push(Math.floor(2*Math.random()));for(var n=t;n<e;n++){var r=this.spawnBlockByType(this._road[n]);r&&(this.node.addChild(r),r.setPosition(n,-1.5,0))}},o.initRoad=function(){this.node.removeAllChildren(),this._road=[],this.generateBlocks(0,this.initRoadLength)},o.generateRoad=function(){var t=this;this._refreshNum+=1,this._canGenRoad=!1;var e=this._road.slice(0,this.initRoadLength-this._refreshStep-10+this.initRoadLength*--this._refreshNum).filter((function(t){return t===gt.BT_STONE})).length;this.node.children.slice(0,e).forEach((function(e){t.node.removeChild(e)})),this.generateBlocks(this._road.length,this._road.length+this.initRoadLength)},o.onStartButtonClicked=function(){this.curState=St.GS_PLAYING,this._startStamp=(new Date).getTime()},o.spawnBlockByType=function(t){if(!this.cubePrfb)return null;var e=null;switch(t){case gt.BT_STONE:e=_(this.cubePrfb)}return e},o.update=function(t){if(this.curState===St.GS_PLAYING&&(this._curStayDuration+=t,this._curStayDuration>this._maxStayDuration&&(this.curState=St.GS_END),this._canGenRoad)){var e=(this.playerCtrl||{}).curMoveIndex,i=void 0===e?0:e;this._road.length-i<this._refreshStep&&this.generateRoad()}},i=e,(n=[{key:"curState",get:function(){return this._curState},set:function(t){var e,i,n=this;switch(this._curState=t,t){case St.GS_INIT:this.init();break;case St.GS_PLAYING:null===(e=this.audioController)||void 0===e||e.play(),this.startMenu&&(this.startMenu.active=!1),this.stepsLabel&&(this.stepsLabel.string="0"),setTimeout((function(){n.playerCtrl&&n.playerCtrl.setInputActive(!0)}),.1);break;case St.GS_END:null===(i=this.audioController)||void 0===i||i.pause(),this.endMenu.active=!0,this.playerCtrl.curMoveIndex>200?this.endTitle.string="不错呦！":500==this.playerCtrl.curMoveIndex?this.endTitle.string="恭喜过关！":this.endTitle.string="再接再厉！",this.endScore.string="得分："+this.playerCtrl.curMoveIndex.toString(),this.endTime.string="总耗时："+(((new Date).getTime()-this._startStamp)/1e3).toFixed(1)+"s"}}}])&&y(i.prototype,n),r&&y(i,r),e}(i)).prototype,"stepsLabel",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=C(rt.prototype,"cubePrfb",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=C(rt.prototype,"initRoadLength",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),lt=C(rt.prototype,"roadMaxLength",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),st=C(rt.prototype,"playerCtrl",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=C(rt.prototype,"startMenu",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=C(rt.prototype,"endMenu",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ht=C(rt.prototype,"endTitle",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=C(rt.prototype,"endScore",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=C(rt.prototype,"endTime",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mt=C(rt.prototype,"_maxStayDuration",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),_t=C(rt.prototype,"audioController",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=rt));t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});
//# sourceMappingURL=index.js.map